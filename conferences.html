<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Omicentra | Conferences</title>
<meta name="description" content="Find where bioinformatics happens next. Track conferences. Never miss a deadline." />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/css/styles.css">
</head>

<body>
<a class="skip-link" href="#main">Skip to content</a>

<div class="container">
<header>
  <a class="brand" href="/index.html">
    <div class="logo">O</div>
    <div>
      <strong>Omicentra</strong>
      <small>Spotlight on bioinformatics</small>
    </div>
  </a>
  <nav>
    <a class="navlink" href="/index.html">Home</a>
    <a class="navlink" href="/conferences.html" aria-current="page">Conferences</a>
  </nav>
</header>

<main id="main">
<h1>Conferences</h1>
<p class="lead">Find where bioinformatics happens next. Track conferences. Never miss a deadline.</p>

<section class="filters">
<input id="q" type="search" placeholder="Search" />

<select id="region"><option value="all">All regions</option></select>
<select id="topic"><option value="all">All topics</option></select>
<select id="format"><option value="all">All formats</option></select>
<select id="deadline">
<option value="all">All deadlines</option>
<option value="only">Only with deadline</option>
</select>
<button id="reset">Reset</button>
</section>

<div class="viewbar">
<div>
<button id="viewCards">Cards</button>
<button id="viewTable">Table</button>
</div>
<div id="status"></div>
</div>

<section id="grid" class="grid"></section>

<section id="tablewrap" hidden>
<table>
<thead>
<tr>
<th><button data-sort="name">Conference</button></th>
<th><button data-sort="dates">Dates</button></th>
<th>Location</th>
<th>Region</th>
<th>Format</th>
<th>Topics</th>
<th><button data-sort="deadline">Deadline</button></th>
<th>Website</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>
</section>

</main>

<footer>
© <span id="year"></span> Omicentra
</footer>
</div>

<script>
document.getElementById("year").textContent = new Date().getFullYear();

const DATA_URL="/data/conferences.json";
const URGENT_DAYS=30;

const grid=document.getElementById("grid");
const tbody=document.getElementById("tbody");
const statusEl=document.getElementById("status");

const q=document.getElementById("q");
const regionSel=document.getElementById("region");
const topicSel=document.getElementById("topic");
const formatSel=document.getElementById("format");
const deadlineSel=document.getElementById("deadline");
const resetBtn=document.getElementById("reset");

let conferences=[];
let sortKey="deadline";
let sortDir="asc";

function midnight(){
const d=new Date();
return new Date(d.getFullYear(),d.getMonth(),d.getDate()).getTime();
}

function parseISO(i){
if(!i)return null;
const t=Date.parse(i+"T00:00:00");
return Number.isNaN(t)?null:t;
}

function isPastOrOngoing(c){
const today=midnight();
const start=parseISO(c.start_date);
const end=parseISO(c.end_date);
if(!start&&!end)return false;
if(start&&end){
if(end<today)return true;
if(start<=today&&end>=today)return true;
return false;
}
if(start&&!end)return start<=today;
if(!start&&end)return end<today;
return false;
}

function daysToDeadline(i){
if(!i)return Infinity;
const t=parseISO(i);
if(!t)return Infinity;
const diff=Math.floor((t-midnight())/(86400000));
return diff<0?Infinity:diff;
}

function formatDate(i){
if(!i)return"TBA";
return new Date(i+"T00:00:00").toLocaleDateString(undefined,{year:"numeric",month:"short",day:"2-digit"});
}

function formatRange(s,e){
if(!s&&!e)return"TBA";
if(s&&!e)return formatDate(s);
if(!s&&e)return formatDate(e);
const sd=new Date(s+"T00:00:00");
const ed=new Date(e+"T00:00:00");
const sameYear=sd.getFullYear()===ed.getFullYear();
const sameMonth=sameYear&&sd.getMonth()===ed.getMonth();
const sDay=sd.toLocaleDateString(undefined,{day:"2-digit"});
const sMon=sd.toLocaleDateString(undefined,{month:"short"});
const eDay=ed.toLocaleDateString(undefined,{day:"2-digit"});
const eMon=ed.toLocaleDateString(undefined,{month:"short"});
if(sameMonth)return`${sDay} – ${eDay} ${eMon} ${sd.getFullYear()}`;
if(sameYear)return`${sDay} ${sMon} – ${eDay} ${eMon} ${sd.getFullYear()}`;
return`${formatDate(s)} – ${formatDate(e)}`;
}

function shortLocation(c){
const city=c.location_city||"";
const country=c.location_country||"";
if(!city&&!country)return"TBA";
let base=city.includes(",")?city.split(",").slice(-2).join(",").trim():city;
let loc=country?`${base}, ${country}`:base;
if(loc.length>34)loc=loc.slice(0,30)+"…";
return loc;
}

function sortData(){
conferences.sort((a,b)=>{
if(sortKey==="name"){
return sortDir==="asc"
? a.name.localeCompare(b.name)
: b.name.localeCompare(a.name);
}
if(sortKey==="dates"){
const as=parseISO(a.start_date)||Infinity;
const bs=parseISO(b.start_date)||Infinity;
return sortDir==="asc"?as-bs:bs-as;
}
const ad=daysToDeadline(a.submission_deadline);
const bd=daysToDeadline(b.submission_deadline);
return sortDir==="asc"?ad-bd:bd-ad;
});
}

function render(){
grid.innerHTML="";
tbody.innerHTML="";
let count=0;

conferences.forEach(c=>{
const title=c.name;
const urgent=daysToDeadline(c.submission_deadline)<=URGENT_DAYS;
const card=document.createElement("article");
card.className="card";
if(urgent)card.classList.add("urgent");

card.innerHTML=`
<h2>
<a class="title-link" href="${c.website}" target="_blank" rel="noopener">
<span>${title}</span>
<span class="arrow">↗</span>
</a>
</h2>
<div class="meta">
<span class="chip">${shortLocation(c)}</span>
<span class="chip">${formatRange(c.start_date,c.end_date)}</span>
${c.submission_deadline?`<span class="chip deadline ${urgent?"urgent-chip":""}">Deadline: ${formatDate(c.submission_deadline)}</span>`:""}
</div>
`;

grid.appendChild(card);

const tr=document.createElement("tr");
tr.innerHTML=`
<td>${title}</td>
<td>${formatRange(c.start_date,c.end_date)}</td>
<td>${shortLocation(c)}</td>
<td>${c.region}</td>
<td>${c.format}</td>
<td>${(c.topic||[]).join(", ")}</td>
<td>${formatDate(c.submission_deadline)}</td>
<td><a href="${c.website}" target="_blank">Website</a></td>
`;
tbody.appendChild(tr);

count++;
});

statusEl.textContent=`${count} conference${count===1?"":"s"}`;
}

async function load(){
const res=await fetch(DATA_URL);
const data=await res.json();
conferences=data.filter(c=>!isPastOrOngoing(c));
sortData();
render();
}

document.querySelectorAll("th button").forEach(btn=>{
btn.addEventListener("click",()=>{
const key=btn.dataset.sort;
if(sortKey===key){
sortDir=sortDir==="asc"?"desc":"asc";
}else{
sortKey=key;
sortDir="asc";
}
sortData();
render();
});
});

load();
</script>
</body>
</html>
